---
import AdminLayout from "../../layouts/AdminLayout.astro";
import { db, concerts, members, merch, posts } from "../../lib/db";
import { count, gte } from "drizzle-orm";

// Get counts from database
const [concertsCount] = await db.select({ count: count() }).from(concerts);
const [membersCount] = await db.select({ count: count() }).from(members);
const [merchCount] = await db.select({ count: count() }).from(merch);
const [postsCount] = await db.select({ count: count() }).from(posts);

// Get upcoming concerts count
const now = new Date().toISOString().split('T')[0];
const [upcomingCount] = await db.select({ count: count() }).from(concerts).where(gte(concerts.date, now));

const stats = [
  { label: "Conciertos", value: concertsCount.count, href: "/admin/conciertos", icon: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" },
  { label: "Miembros", value: membersCount.count, href: "/admin/miembros", icon: "M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" },
  { label: "Productos", value: merchCount.count, href: "/admin/tienda", icon: "M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" },
  { label: "Posts", value: postsCount.count, href: "/admin/archivo", icon: "M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" },
];
---

<AdminLayout title="Dashboard">
  <div class="admin-header">
    <h1 class="admin-title">Dashboard</h1>
    <p class="admin-subtitle">Panel de administraci칩n de Legacy of the Seas</p>
  </div>

  <!-- Stats grid -->
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
    {stats.map((stat) => (
      <a href={stat.href} class="card" style="text-decoration: none; transition: transform 0.15s, border-color 0.15s;">
        <div style="display: flex; align-items: center; gap: 1rem;">
          <div style="background: rgba(0, 206, 209, 0.1); padding: 0.75rem; border-radius: 0.5rem;">
            <svg style="width: 24px; height: 24px; color: var(--admin-accent);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={stat.icon} />
            </svg>
          </div>
          <div>
            <div style="font-size: 1.5rem; font-weight: 600; color: var(--admin-text);">{stat.value}</div>
            <div style="font-size: 0.875rem; color: var(--admin-muted);">{stat.label}</div>
          </div>
        </div>
      </a>
    ))}
  </div>

  <!-- Quick info -->
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
    <div class="card">
      <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Pr칩ximos conciertos</h3>
      <p style="font-size: 2rem; font-weight: 600; color: var(--admin-accent);">{upcomingCount.count}</p>
      <p style="font-size: 0.875rem; color: var(--admin-muted); margin-top: 0.5rem;">
        {upcomingCount.count === 0 ? "No hay conciertos programados" : "conciertos programados"}
      </p>
      <a href="/admin/conciertos/nuevo" class="btn btn-primary" style="margin-top: 1rem;">
        <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        A침adir concierto
      </a>
    </div>

    <div class="card">
      <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Acciones r치pidas</h3>
      <div style="display: flex; flex-direction: column; gap: 0.5rem;">
        <a href="/admin/conciertos/nuevo" class="btn btn-secondary">Nuevo concierto</a>
        <a href="/admin/archivo/nuevo" class="btn btn-secondary">Nuevo post</a>
        <a href="/admin/tienda/nuevo" class="btn btn-secondary">Nuevo producto</a>
      </div>
    </div>
  </div>
</AdminLayout>
